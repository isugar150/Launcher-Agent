<!DOCTYPE html>
<meta charset="utf-8" />
<head>
    <title>TMT Agent 테스트</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript">
        var version = "1.0.0";
            

		function runTMT(){
			var data = RunTMT($('#sawonNo').val());
			connectWebSocket(data);
		}
		function closeTMT(){
			var data = CloseTMT($('#sawonNo').val());
			connectWebSocket(data);
		}
		function openChatRoom(){
			var data = OpenChatRoom($('#sawonNo').val());
			connectWebSocket(data);
		}
		
		function connectWebSocket(sendData){
			if ('WebSocket' in window) {
				var ws = new WebSocket('ws://127.0.0.1:49862');
				
				if(ws.readyState == 0){
					console.log("TMT Agent 설치 후 다시시도하세요.");
				}
			
				// 웹소켓이 연결되었을때
				ws.onopen = function () {
					console.log('connected');
			
					ws.send(sendData);
				};
			
				// 메세지를 받았을때
				ws.onmessage = function (msg) {
					console.log('data: ' + msg.data);
					ws.close();
				};
			
				// 연결이 끊어졌을때
				ws.onclose = function () {
					console.log('connection is closed');
					ws.close();
				};
			}
			else
				console.log('WebSocket not supported.');
		}

        function RunTMT(sawonNo){
            // 리스트 생성
            var sendList = new Array() ;

            // 객체 생성
            var data = new Object() ;

            data.method = 'RunTMT';
            data.sawonNo = sawonNo;
            data.version = version;

            // 리스트에 생성된 객체 삽입
            sendList.push(data) ;

            // String 형태로 변환
            var jsonData = JSON.stringify(sendList);

            console.log(jsonData);
            
            return jsonData;
        }
		
        function CloseTMT(sawonNo){
            // 리스트 생성
            var sendList = new Array() ;

            // 객체 생성
            var data = new Object() ;

            data.method = 'CloseTMT';
            data.sawonNo = sawonNo;
            data.version = version;

            // 리스트에 생성된 객체 삽입
            sendList.push(data) ;

            // String 형태로 변환
            var jsonData = JSON.stringify(sendList);

            console.log(jsonData);
            
            return jsonData;
        }
		
        function OpenChatRoom(sawonNo){
            // 리스트 생성
            var sendList = new Array() ;

            // 객체 생성
            var data = new Object() ;

            data.method = 'openChatRoom';
            data.userIdnfr = sawonNo;
            data.version = version;

            // 리스트에 생성된 객체 삽입
            sendList.push(data) ;

            // String 형태로 변환
            var jsonData = JSON.stringify(sendList);

            console.log(jsonData);
            
            return jsonData;
        }
    </script>
</head>
    <body>
		<input type="text" id="sawonNo" />
		<button id="login" onclick="runTMT()">로그인</button>
		<button id="close" onclick="closeTMT()">닫기</button>
		<button id="openChatRoom" onclick="openChatRoom()">채팅방 열기(번호)</button>
		<button onclick="location.href='/TMTAgent.exe'">실행파일 다운로드</button>
    </body>
</html>